-- Artists Table
CREATE TABLE artists (
    artist_id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    genres TEXT[] -- Multiple genres per artist
);

-- Albums Table
CREATE TABLE albums (
    album_id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    artist_id INT REFERENCES artists(artist_id) ON DELETE CASCADE,
    release_date DATE,
    total_tracks INT,
    cover_url TEXT
);

-- Tracks Table
CREATE TABLE tracks (
    track_id SERIAL PRIMARY KEY,
    album_id INT REFERENCES albums(album_id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    duration_ms INT,
    language VARCHAR(50),
    explicit BOOLEAN,
    track_number INT,
    popularity INT CHECK (popularity BETWEEN 0 AND 100),
    preview_url TEXT
);

-- Lyrics Table
CREATE TABLE lyrics (
    lyrics_id SERIAL PRIMARY KEY,
    track_id INT REFERENCES tracks(track_id) ON DELETE CASCADE,
    content TEXT NOT NULL,
    language VARCHAR(50),
    keywords TEXT[], -- For NLP applications
    sentiment VARCHAR(50) -- e.g., positive, negative, neutral
);

-- Audio Analysis Table 
CREATE TABLE audio_analysis (
    analysis_id SERIAL PRIMARY KEY,
    track_id INT REFERENCES tracks(track_id) ON DELETE CASCADE,
    file_path TEXT NOT NULL,
    
    -- Time & Audio Info
    duration_seconds FLOAT,
    sample_rate INTEGER,
    tempo FLOAT,
    loudness FLOAT,
    key TEXT,
    mode INT,
    time_signature INT,
    is_processed BOOLEAN DEFAULT TRUE,
    upload_timestamp TIMESTAMP DEFAULT NOW(),

    -- Musical Features
    danceability FLOAT,
    energy FLOAT,
    speechiness FLOAT,
    acousticness FLOAT,
    instrumentalness FLOAT,
    liveness FLOAT,
    valence FLOAT,

    -- Spectral Features
    spectral_centroid FLOAT,
    spectral_rolloff FLOAT,
    spectral_bandwidth FLOAT,
    spectral_contrast FLOAT[], -- Array of values

    -- Additional Waveform Features
    zero_crossing_rate FLOAT,
    rms_energy FLOAT,

    -- MFCCs
    mfcc_1 FLOAT,
    mfcc_2 FLOAT,
    mfcc_3 FLOAT,
    mfcc_4 FLOAT,
    mfcc_5 FLOAT,
    mfcc_6 FLOAT,
    mfcc_7 FLOAT,
    mfcc_8 FLOAT,
    mfcc_9 FLOAT,
    mfcc_10 FLOAT,
    mfcc_11 FLOAT,
    mfcc_12 FLOAT,
    mfcc_13 FLOAT
);
